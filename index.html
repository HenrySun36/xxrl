<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雄安新兴戎利公司运管部台账</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', 'Microsoft Yahei', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        .kpi-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 320px; /* Base height */
            max-height: 350px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .tab {
            cursor: pointer;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .tab.active {
            background-color: #0f172a;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        .tab:not(.active) {
            background-color: #f1f5f9;
            color: #334155;
        }
        .tab:hover:not(.active) {
            background-color: #e2e8f0;
        }
        .progress-bar-bg {
            background-color: #e2e8f0;
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-bar-fg {
            height: 100%;
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
        }
        .badge {
            display: inline-block;
            padding: 0.25em 0.6em;
            font-size: 0.75em;
            font-weight: 600;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.375rem;
        }
        .contract-table {
            width: 100%;
            table-layout: fixed;
            border-collapse: collapse;
        }
        .contract-table th {
            text-align: left;
            padding: 0.75rem 0.5rem;
            background-color: #f1f5f9;
            font-weight: 600;
            color: #334155;
            border-bottom: 2px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .contract-table td {
            padding: 0.65rem 0.75rem;
            vertical-align: middle;
            overflow: visible;
            white-space: normal;
            word-wrap: break-word;
        }
        .contract-table tbody tr:hover {
            background-color: #f8fafc;
        }
        .col-name {
            width: 28%;
            min-width: 180px;
        }
        .col-partner {
            width: 22%;
            min-width: 150px;
        }
        .col-amount {
            width: 12%;
            min-width: 100px;
        }
        thead .col-amount {
            text-align: left;
        }
        tbody .col-amount {
            text-align: left;
        }
        .col-location {
            width: 14%;
            min-width: 120px;
        }
        .col-date {
            width: 10%;
            min-width: 90px;
        }
        .col-status {
            width: 8%;
            min-width: 80px;
        }
        .col-progress {
            width: 12%;
            min-width: 120px;
        }
        .col-invoice {
            width: 8%;
            min-width: 80px;
        }
        .col-manager {
            width: 8%;
            min-width: 80px;
        }
        .container {
            max-width: 1200px;
        }

    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">雄安新兴戎利运管部智能台账仪表盘</h1>
            <p class="mt-2 text-lg text-slate-600">从记录到管理：实时洞察合同执行与财务健康状况</p>
        </header>

        <nav class="flex justify-center items-center space-x-2 sm:space-x-4 mb-8">
            <button id="tab-winning" class="tab active">中标合同</button>
            <button id="tab-procurement" class="tab">采购合同</button>
        </nav>

        <!-- 搜索和筛选区域 -->
        <section class="bg-white p-4 sm:p-6 rounded-lg shadow-md mb-8">
            <div class="flex flex-col sm:flex-row gap-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 flex-grow">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">搜索</label>
                        <input type="text" id="search-input" placeholder="输入合同名称、合作方等关键词" 
                               class="w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">合同状态</label>
                        <select id="status-filter" 
                                class="w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">全部状态</option>
                            <option value="执行中">执行中</option>
                            <option value="已完结">已完结</option>
                            <option value="已归档">已归档</option>
                            <option value="未开始">未开始</option>
                            <option value="中止">中止</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">发票状态</label>
                        <select id="invoice-filter" 
                                class="w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">全部发票状态</option>
                            <option value="已开完">已开完</option>
                            <option value="已开部分">已开部分</option>
                            <option value="未开">未开</option>
                            <option value="已收">已收</option>
                            <option value="未收">未收</option>
                        </select>
                    </div>
                </div>
                <div class="flex items-end">
                    <button
                        id="export-button"
                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                    >
                        导出数据
                    </button>
                </div>
            </div>
        </section>

        <main id="dashboard-content">
            <!-- Content will be dynamically rendered here -->
        </main>
    </div>

    <script>
        const winningContractsData = [
            { id: 1, name: '容城县中医医院物业服务采购合同', client: '容城县中医院', amount: 7695520, type: '医疗康养类', signDate: '2024-12-24', endDate: '2027-12-23', received: 3500000, invoiceStatus: '已开部分', status: '执行中', manager: '宋来庆' },
            { id: 2, name: '容城县中医医院物业服务采购合同补充协议', client: '容城县中医院', amount: 114007.7, type: '医疗康养类', signDate: '2024-12-24', endDate: '2027-12-23', received: 0, invoiceStatus: '未开', status: '执行中', manager: '宋来庆' },
            { id: 3, name: '弥渡好来世纪广场2栋物业委托服务合同', client: '中国新兴建设开发有限责任公司', amount: 645538.08, type: '住宅类', signDate: '2024-11-13', endDate: '2027-7-31', received: 600000, invoiceStatus: '已开部分', status: '执行中', manager: '王燕飚' },
            { id: 4, name: '容东安兴社区服务中心入室保洁服务合同', client: '中国雄安集团公共服务管理有限公司', amount: 8320, type: '公共建筑类', signDate: '2024-12-20', endDate: '2025-9-20', received: 0, invoiceStatus: '未开', status: '未开始', manager: '张三' },
            { id: 5, name: '雄安体育中心项目（体育馆部分）承接查验服务合同', client: '雄安体育中心运营管理有限公司', amount: 716876, type: '公共建筑类', signDate: '2025-2-21', endDate: '2025-3-31', received: 716876, invoiceStatus: '已开完', status: '已完结', manager: '牛自航' },
            { id: 6, name: '北京中兴医院门诊综合楼物业服务采购项目合同', client: '北京中兴医院', amount: 1403000, type: '医疗康养类', signDate: '2025-2-24', endDate: '2027-2-28', received: 100000, invoiceStatus: '未开', status: '执行中', manager: '王五' },
            { id: 7, name: '老山西街10号院8、9、10号楼物业管理服务合同', client: '老山西街10号院全体业主', amount: 1900000, type: '住宅类', signDate: '2025-2-1', endDate: '2028-1-31', received: 0, invoiceStatus: '未开', status: '未开始', manager: '王五' },
            { id: 8, name: '容西学校2025年物业服务采购项目合同', client: '容城县教育局', amount: 2436243.84, type: '公共建筑类', signDate: '2025-2-21', endDate: '2026-2-20', received: 2436243.84, invoiceStatus: '已开完', status: '已归档', manager: '何向东' },
            { id: 9, name: '弥渡好来世纪广场2栋屋顶检修合同', client: '中国新兴建设开发有限责任公司', amount: 280000, type: '其它', signDate: '2025-4-17', endDate: '2027-7-31', received: 0, invoiceStatus: '未开', status: '未开始', manager: '王燕飚' },
            { id: 10, name: '弥渡好来世纪广场2栋消防设施设备维修合同', client: '中国新兴建设开发有限责任公司', amount: 28726.82, type: '其它', signDate: '2025-4-17', endDate: '2025-5-17', received: 28726.82, invoiceStatus: '已开完', status: '已完结', manager: '王燕飚' },
            { id: 11, name: '雄安体育中心项目承接查验服务合同（补充协议）', client: '雄安体育中心运营管理有限公司', amount: 512500, type: '公共建筑类', signDate: '2025-2-1', endDate: '2025-4-18', received: 0, invoiceStatus: '未开', status: '执行中', manager: '牛自航' },
            { id: 12, name: '保定宝石花东方医院保洁服务外包合同', client: '保定宝石花东方医院', amount: 728794, type: '医疗康养类', signDate: '2025-6-15', endDate: '2026-6-14', received: 0, invoiceStatus: '未开', status: '未开始', manager: '许云舒' },
            { id: 13, name: '雄安体育中心项目2025年度物业服务标段一合同', client: '通用技术集团物业管理有限公司', amount: 4435614.68, type: '公共建筑类', signDate: '2025-6-20', endDate: '2026-4-20', received: 0, invoiceStatus: '未开', status: '未开始', manager: '牛自航' },
            { id: 14, name: '华北石油管理局总医院健康管理部增设医辅服务项目合同', client: '华北石油管理局总医院', amount: 474000, type: '医疗康养类', signDate: '2025-8-8', endDate: '2026-8-7', received: 0, invoiceStatus: '未开', status: '未开始', manager: '王新兰' },
        ];

        const procurementContractsData = [
            { id: 1, name: '消防维保服务委托合同', supplier: '云南安高科技有限公司', amount: 31900, type: '其它', signDate: '2024-9-1', endDate: '2025-8-31', paid: 31900, invoiceStatus: '已收', status: '已完结', manager: '王燕飚', projectName: '弥渡好来世纪广场项目', unit: '新兴戎利', contractNo: 'XXRL-MDSC-WB-2024-01', location: '云南省弥渡县' },
            { id: 2, name: '电梯维保项目服务委托合同', supplier: '云南奥菱电梯有限公司', amount: 66400, type: '其它', signDate: '2024-9-1', endDate: '2025-8-31', paid: 66400, invoiceStatus: '已收', status: '已完结', manager: '王燕飚', projectName: '弥渡好来世纪广场项目', unit: '新兴戎利', contractNo: 'XXRL-MD-2024-08', location: '云南省弥渡县' },
            { id: 3, name: '劳务服务外包合同', supplier: '大理恒晟保安服务有限责任公司', amount: 198900, type: '住宅类', signDate: '2024-8-30', endDate: '2025-8-31', paid: 198900, invoiceStatus: '已收', status: '已完结', manager: '王燕飚', projectName: '弥渡好来世纪广场项目', unit: '新兴戎利', contractNo: 'XXRL-MDSC-FW-2024-01', location: '云南省弥渡县' },
            { id: 4, name: '容城县中医医院保洁服务及劳务派遣服务项目服务协议', supplier: '容城县鑫三物业管理有限公司', amount: 320100, type: '医疗康养类', signDate: '2024-12-24', endDate: '2025-12-23', paid: 320100, invoiceStatus: '已收', status: '已完结', manager: '宋来庆', projectName: '容城中医医院项目', unit: '新兴戎利', contractNo: 'XXRL-RS-YJ-202412', location: '河北省容城县' },
            { id: 5, name: '容城县中医医院保洁项目保洁服务合同', supplier: '容城县鑫三物业管理有限公司', amount: 3394800, type: '医疗康养类', signDate: '2024-12-24', endDate: '2027-12-23', paid: 1697400, invoiceStatus: '已收部分', status: '执行中', manager: '宋来庆', projectName: '容城中医医院项目', unit: '新兴戎利', contractNo: 'XXGG-BJ202412', location: '河北省容城县' },
            { id: 6, name: '容城县中医医院物业服务临时协议', supplier: '容城县鑫三物业管理有限公司', amount: 107167.24, type: '医疗康养类', signDate: '2024-12-8', endDate: '2024-12-23', paid: 107167.24, invoiceStatus: '已收', status: '已完结', manager: '宋来庆', projectName: '容城中医医院项目', unit: '新兴戎利', contractNo: '/', location: '河北省容城县' },
            { id: 7, name: '北京大学人民医院雄安院区生物样本库临时物业保障项目服务合同', supplier: '北京瑞成盛业物业管理有限公司', amount: 243156, type: '医疗康养类', signDate: '2025-1-15', endDate: '2025-7-15', paid: 121578, invoiceStatus: '已收部分', status: '执行中', manager: '孙七', projectName: '北京大学人民医院雄安院区生物样本库临时物业保障项目', unit: '新兴戎利', contractNo: 'XXRL-BR-YJC-202501-01', location: '河北省容城县' },
            { id: 8, name: '容城县中医医院物业业务劳务派遣服务合同', supplier: '容城县星业人力资源服务有限公司', amount: 3518000, type: '医疗康养类', signDate: '2025-3-24', endDate: '2027-12-23', paid: 879500, invoiceStatus: '已收部分', status: '执行中', manager: '宋来庆', projectName: '容城中医医院', unit: '新兴戎利', contractNo: '2025-XXRL-RCYZ-FW-001', location: '河北省容城县' },
            { id: 9, name: '雄安体育中心项目（体育馆部分）承接查验服务合同', supplier: '北京瑞成盛业物业管理有限公司', amount: 643085.92, type: '公共建筑类', signDate: '2025-2-21', endDate: '2025-3-31', paid: 643085.92, invoiceStatus: '已收', status: '已完结', manager: '牛自航', projectName: '雄安体育中心项目', unit: '新兴戎利', contractNo: '2025-XXRL-TYZY-FW-004', location: '河北省容城县' },
            { id: 10, name: '容西校园望泉小学、兴学幼儿园2025年物业服务采购合同', supplier: '宸宜（天津）物业管理有限公司', amount: 118444.82, type: '公共建筑类', signDate: '2025-2-21', endDate: '2025-2-20', paid: 118444.82, invoiceStatus: '已收', status: '已完结', manager: '何向东', projectName: '容西学校项目', unit: '新兴戎利', contractNo: '2025-XXRL-RCXX-FW-005', location: '河北省容城县' },
            { id: 11, name: '容西校园华兴初中2025年物业服务采购合同', supplier: '宸宜（天津）物业管理有限公司', amount: 820002.6, type: '公共建筑类', signDate: '2025-2-21', endDate: '2026-2-20', paid: 410001.3, invoiceStatus: '已收部分', status: '执行中', manager: '何向东', projectName: '容西学校项目', unit: '新兴戎利', contractNo: '2025-XXRL-RCXX-FW-004', location: '河北省容城县' },
            { id: 12, name: '容西校园望泉小学2025年物业服务采购合同', supplier: '宸宜（天津）物业管理有限公司', amount: 747993.91, type: '公共建筑类', signDate: '2025-2-21', endDate: '2026-2-20', paid: 373996.96, invoiceStatus: '已收部分', status: '执行中', manager: '何向东', projectName: '容西学校项目', unit: '新兴戎利', contractNo: '2025-XXRL-RCXX-FW-003', location: '河北省容城县' },
            { id: 13, name: '容西校园兴学幼儿园2025年物业服务采购合同', supplier: '河北雄安九力人力资源管理有限公司', amount: 550498, type: '公共建筑类', signDate: '2025-3-21', endDate: '2026-2-20', paid: 275249, invoiceStatus: '已收部分', status: '执行中', manager: '何向东', projectName: '容西学校项目', unit: '新兴戎利', contractNo: '2025-XXRL-RCXX-FW-002', location: '河北省容城县' },
            { id: 14, name: '非居民垃圾收运处置服务合同', supplier: '中国雄安集团生态建设投资有限公司', amount: 240102.5, type: '公共建筑类', signDate: '2025-3-28', endDate: '2025-6-30', paid: 240102.5, invoiceStatus: '已收', status: '已完结', manager: '牛自航', projectName: '雄安体育中心项目', unit: '新兴戎利', contractNo: 'XAQT-QT-2025-0154', location: '河北省容城县' },
            { id: 15, name: '写字楼租赁合同', supplier: '河北雄安商务服务中心有限公司', amount: 1770207.26, type: '公共建筑类', signDate: '2025-4-1', endDate: '2026-3-31', paid: 885103.63, invoiceStatus: '已收部分', status: '执行中', manager: '吴九', projectName: '雄安商务服务中心项目', unit: '新兴戎利', contractNo: 'CSFZ-ZL-001-0018-XZL-2025-01', location: '河北省容城县' },
            { id: 16, name: '物业服务协议', supplier: '河北雄安城市发展生活服务有限公司', amount: 1381417.2, type: '公共建筑类', signDate: '2025-4-1', endDate: '2026-3-31', paid: 690708.6, invoiceStatus: '已收部分', status: '执行中', manager: '孙七', projectName: '雄安商务服务中心项目', unit: '新兴戎利', contractNo: 'CSFZ-FW-2025-0019-GF-XXRL', location: '河北省容城县' },
            { id: 17, name: '雄安体育中心临勤服务合同', supplier: '河北雄安城市发展生活服务有限公司', amount: 176840, type: '公共建筑类', signDate: '2025-3-21', endDate: '2025-4-1', paid: 176840, invoiceStatus: '已收', status: '已完结', manager: '牛自航', projectName: '雄安体育中心项目', unit: '新兴戎利', contractNo: '2025-XXRL-TYZY-FW-006-01', location: '河北省容城县' },
        ];

        let currentTab = 'winning';
        let filteredWinningData = [...winningContractsData];
        let filteredProcurementData = [...procurementContractsData];

        // 获取项目地点
        function getProjectLocation(contractName) {
            if (contractName.includes('容城县中医医院')) {
                return '河北省容城县';
            }
            if (contractName.includes('容城') || contractName.includes('容西')) {
                return '河北雄安容城县';
            }
            if (contractName.includes('体育中心') || contractName.includes('雄安体育中心')) {
                return '河北省容城县';
            }
            if (contractName.includes('弥渡')) {
                return '云南省弥渡县';
            }
            if (contractName.includes('北京')) {
                return '北京市';
            }
            if (contractName.includes('老山西街')) {
                return '北京市';
            }
            if (contractName.includes('保定')) {
                return '河北省保定市';
            }
            if (contractName.includes('华北石油')) {
                return '河北省任丘市';
            }
            return '其他';
        }

        // 格式化金额
        function formatAmount(amount) {
            if (amount >= 10000) {
                return (amount / 10000).toFixed(2) + '万';
            }
            return amount.toLocaleString();
        }

        // 获取状态样式
        function getStatusBadgeClass(status) {
            switch (status) {
                case '执行中': return 'bg-blue-100 text-blue-800';
                case '已完结': return 'bg-green-100 text-green-800';
                case '已归档': return 'bg-gray-100 text-gray-800';
                case '未开始': return 'bg-yellow-100 text-yellow-800';
                case '中止': return 'bg-red-100 text-red-800';
                default: return 'bg-slate-100 text-slate-800';
            }
        }

        // 获取发票状态样式
        function getInvoiceStatusBadgeClass(status) {
            if (status.includes('已开完') || status.includes('已收')) {
                return 'bg-green-100 text-green-800';
            } else if (status.includes('已开部分') || status.includes('已收部分')) {
                return 'bg-yellow-100 text-yellow-800';
            } else {
                return 'bg-red-100 text-red-800';
            }
        }

        // 渲染KPI卡片
        function renderKPICards(data, type) {
            const totalAmount = data.reduce((sum, item) => sum + item.amount, 0);
            const totalReceived = data.reduce((sum, item) => sum + (type === 'winning' ? item.received || 0 : item.paid || 0), 0);
            const completedAmount = data.filter(item => item.status === '已完结').reduce((sum, item) => sum + item.amount, 0);
            const inProgressAmount = data.filter(item => item.status === '执行中').reduce((sum, item) => sum + item.amount, 0);

            return `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="kpi-card">
                        <h3 class="text-lg font-semibold text-slate-700 mb-2">总合同金额</h3>
                        <p class="text-3xl font-bold text-blue-600">${formatAmount(totalAmount)}</p>
                    </div>
                    <div class="kpi-card">
                        <h3 class="text-lg font-semibold text-slate-700 mb-2">${type === 'winning' ? '已收款' : '已付款'}</h3>
                        <p class="text-3xl font-bold text-green-600">${formatAmount(totalReceived)}</p>
                        <p class="text-sm text-slate-500 mt-1">占比 ${((totalReceived / totalAmount) * 100).toFixed(1)}%</p>
                    </div>
                    <div class="kpi-card">
                        <h3 class="text-lg font-semibold text-slate-700 mb-2">已完结金额</h3>
                        <p class="text-3xl font-bold text-purple-600">${formatAmount(completedAmount)}</p>
                    </div>
                    <div class="kpi-card">
                        <h3 class="text-lg font-semibold text-slate-700 mb-2">执行中金额</h3>
                        <p class="text-3xl font-bold text-orange-600">${formatAmount(inProgressAmount)}</p>
                    </div>
                </div>
            `;
        }

        // 渲染图表
        function renderCharts(data, type) {
            const typeAmounts = {};
            const monthlyData = {};
            const statusData = {};

            data.forEach(item => {
                // 按类型统计
                typeAmounts[item.type] = (typeAmounts[item.type] || 0) + item.amount;
                
                // 按状态统计
                statusData[item.status] = (statusData[item.status] || 0) + 1;

                // 按月份统计
                const month = item.signDate.substring(0, 7);
                monthlyData[month] = (monthlyData[month] || 0) + item.amount;
            });

            return `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold mb-4">合同类型分布</h3>
                        <div class="chart-container">
                            <canvas id="typeChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold mb-4">合同状态统计</h3>
                        <div class="chart-container">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold mb-4">月度合同金额</h3>
                        <div class="chart-container">
                            <canvas id="monthlyChart"></canvas>
                        </div>
                    </div>
                </div>
            `;
        }

        // 渲染表格
        function renderTable(data, type) {
            const contractNameHeader = type === 'winning' ? '合同名称' : '合同名称';
            const partnerHeader = type === 'winning' ? '客户' : '供应商';
            const amountHeader = type === 'winning' ? '合同金额' : '合同金额';
            const receivedHeader = type === 'winning' ? '已收款' : '已付款';

            return `
                <div class="bg-white rounded-lg shadow-md overflow-x-auto">
                    <table class="contract-table">
                        <thead>
                            <tr>
                                <th class="col-name">${contractNameHeader}</th>
                                <th class="col-partner">${partnerHeader}</th>
                                <th class="col-amount">${amountHeader}</th>
                                <th class="col-location">项目地点</th>
                                <th class="col-date">签订日期</th>
                                <th class="col-status">状态</th>
                                <th class="col-progress">${receivedHeader}</th>
                                <th class="col-invoice">发票状态</th>
                                <th class="col-manager">负责人</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.map(item => `
                                <tr class="border-b border-slate-200">
                                    <td class="col-name">
                                        <div class="font-medium text-slate-900">${item.name}</div>
                                        <div class="text-sm text-slate-500">${item.type}</div>
                                    </td>
                                    <td class="col-partner text-slate-700">${type === 'winning' ? item.client : item.supplier}</td>
                                    <td class="col-amount font-semibold text-slate-900">${formatAmount(item.amount)}</td>
                                    <td class="col-location text-slate-700">${getProjectLocation(item.name)}</td>
                                    <td class="col-date text-slate-700">${item.signDate}</td>
                                    <td class="col-status">
                                        <span class="badge ${getStatusBadgeClass(item.status)}">${item.status}</span>
                                    </td>
                                    <td class="col-progress">
                                        <div class="text-sm font-medium text-slate-900">
                                            ${formatAmount(type === 'winning' ? item.received || 0 : item.paid || 0)}
                                        </div>
                                        <div class="progress-bar-bg h-2 mt-1">
                                            <div class="progress-bar-fg bg-blue-500" style="width: ${((type === 'winning' ? item.received || 0 : item.paid || 0) / item.amount) * 100}%"></div>
                                        </div>
                                        <div class="text-xs text-slate-500 mt-1">
                                            ${(((type === 'winning' ? item.received || 0 : item.paid || 0) / item.amount) * 100).toFixed(1)}%
                                        </div>
                                    </td>
                                    <td class="col-invoice">
                                        <span class="badge ${getInvoiceStatusBadgeClass(item.invoiceStatus)}">${item.invoiceStatus}</span>
                                    </td>
                                    <td class="col-manager text-slate-700">${item.manager}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // 初始化图表
        function initCharts(data) {
            // 类型分布饼图
            const typeCtx = document.getElementById('typeChart');
            if (typeCtx) {
                const typeAmounts = {};
                data.forEach(item => {
                    typeAmounts[item.type] = (typeAmounts[item.type] || 0) + item.amount;
                });

                new Chart(typeCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(typeAmounts),
                        datasets: [{
                            data: Object.values(typeAmounts),
                            backgroundColor: [
                                '#3b82f6',
                                '#10b981',
                                '#f59e0b',
                                '#ef4444',
                                '#8b5cf6',
                                '#06b6d4'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // 状态分布饼图
            const statusCtx = document.getElementById('statusChart');
            if (statusCtx) {
                const statusCounts = {};
                data.forEach(item => {
                    statusCounts[item.status] = (statusCounts[item.status] || 0) + 1;
                });

                new Chart(statusCtx, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(statusCounts),
                        datasets: [{
                            data: Object.values(statusCounts),
                            backgroundColor: [
                                '#3b82f6',
                                '#10b981',
                                '#6b7280',
                                '#f59e0b',
                                '#ef4444'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // 月度金额柱状图
            const monthlyCtx = document.getElementById('monthlyChart');
            if (monthlyCtx) {
                const monthlyData = {};
                data.forEach(item => {
                    const month = item.signDate.substring(0, 7);
                    monthlyData[month] = (monthlyData[month] || 0) + item.amount;
                });

                const sortedMonths = Object.keys(monthlyData).sort();

                new Chart(monthlyCtx, {
                    type: 'bar',
                    data: {
                        labels: sortedMonths,
                        datasets: [{
                            label: '合同金额',
                            data: sortedMonths.map(month => monthlyData[month]),
                            backgroundColor: '#3b82f6'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return formatAmount(value);
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // 渲染内容
        function renderContent() {
            const content = document.getElementById('dashboard-content');
            let data, type;

            if (currentTab === 'winning') {
                data = filteredWinningData;
                type = 'winning';
            } else {
                data = filteredProcurementData;
                type = 'procurement';
            }

            content.innerHTML = `
                ${renderKPICards(data, type)}
                ${renderCharts(data, type)}
                ${renderTable(data, type)}
            `;

            // 延迟初始化图表，确保DOM已更新
            setTimeout(() => initCharts(data), 100);
        }

        // 搜索和筛选功能
        function filterData() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;
            const invoiceFilter = document.getElementById('invoice-filter').value;

            filteredWinningData = winningContractsData.filter(item => {
                const matchesSearch = !searchTerm || 
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.client.toLowerCase().includes(searchTerm) ||
                    item.manager.toLowerCase().includes(searchTerm);
                
                const matchesStatus = !statusFilter || item.status === statusFilter;
                const matchesInvoice = !invoiceFilter || item.invoiceStatus === invoiceFilter;

                return matchesSearch && matchesStatus && matchesInvoice;
            });

            filteredProcurementData = procurementContractsData.filter(item => {
                const matchesSearch = !searchTerm || 
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.supplier.toLowerCase().includes(searchTerm) ||
                    item.manager.toLowerCase().includes(searchTerm);
                
                const matchesStatus = !statusFilter || item.status === statusFilter;
                const matchesInvoice = !invoiceFilter || item.invoiceStatus === invoiceFilter;

                return matchesSearch && matchesStatus && matchesInvoice;
            });

            renderContent();
        }

        // 导出功能
        function exportData() {
            let data, filename;
            if (currentTab === 'winning') {
                data = filteredWinningData;
                filename = '中标合同数据.csv';
            } else {
                data = filteredProcurementData;
                filename = '采购合同数据.csv';
            }

            const headers = currentTab === 'winning' 
                ? ['合同名称', '客户', '合同金额', '项目地点', '签订日期', '状态', '已收款', '发票状态', '负责人']
                : ['合同名称', '供应商', '合同金额', '项目地点', '签订日期', '状态', '已付款', '发票状态', '负责人'];

            let csvContent = headers.join(',') + '\n';
            
            data.forEach(item => {
                const row = [
                    `"${item.name}"`,
                    `"${currentTab === 'winning' ? item.client : item.supplier}"`,
                    item.amount,
                    `"${getProjectLocation(item.name)}"`,
                    `"${item.signDate}"`,
                    `"${item.status}"`,
                    currentTab === 'winning' ? (item.received || 0) : (item.paid || 0),
                    `"${item.invoiceStatus}"`,
                    `"${item.manager}"`
                ];
                csvContent += row.join(',') + '\n';
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        // 事件监听
        document.getElementById('tab-winning').addEventListener('click', () => {
            currentTab = 'winning';
            document.getElementById('tab-winning').classList.add('active');
            document.getElementById('tab-procurement').classList.remove('active');
            renderContent();
        });

        document.getElementById('tab-procurement').addEventListener('click', () => {
            currentTab = 'procurement';
            document.getElementById('tab-procurement').classList.add('active');
            document.getElementById('tab-winning').classList.remove('active');
            renderContent();
        });

        document.getElementById('search-input').addEventListener('input', filterData);
        document.getElementById('status-filter').addEventListener('change', filterData);
        document.getElementById('invoice-filter').addEventListener('change', filterData);
        document.getElementById('export-button').addEventListener('click', exportData);

        // 初始渲染
        renderContent();
    </script>
</body>
</html>